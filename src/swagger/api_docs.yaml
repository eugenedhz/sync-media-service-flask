################################################################################
#                              API Information                                 #
################################################################################
info:
  title: 'ilow Media Service API DOCS'
  description: |
      ## USAGE

      Just scroll down to the **interactive API requests**!
      
      -----------------------------------------------

      ## REQUEST HTTP METHODS 

      - To `create` something use ***POST*** method

      - To `get` something use ***GET*** method

      - To `update` something use ***PATCH*** method

      - To `delete` something use ***DELETE*** method

      -----------------------------------------------

      ## ***API ERRORS***

      üìù **Note:** Some errors may have human-readable `description` field.
      
      | Status Code | Status Description | Message |
      | --- | --- | --- |
      | ***Global errors*** |
      | 405 | METHOD NOT ALLOWED | ***METHOD_NOT_ALLOWED*** |
      | 404 | NOT FOUND | ***RESOURCE_NOT_FOUND*** |
      | 500 | INTERNAL SERVER ERROR | ***INTERNAL_SERVER_ERROR*** |
      | 403 | FORBIDDEN | ***ADMIN_RIGHTS_REQUIRED*** |
      | ***JSON validation errors*** |
      | 400 | BAD REQUEST | ***"field_name": "MISSING_FIELD"*** |
      | 400 | BAD REQUEST | ***"field_name": "UNKNOWN_FIELD"*** |
      | 400 | BAD REQUEST | ***"field_name": "INVALID_LENGTH"*** |
      | 400 | BAD REQUEST | ***"field_name": "INVALID_RANGE"*** |
      | 400 | BAD REQUEST | ***"field_name": "REGEXP_MISMATCH"*** |
      | 400 | BAD REQUEST | ***"field_name": "INVALID_TYPE"*** |
      | 400 | BAD REQUEST | ***"field_name": "NOT_NULLABLE"*** |
      | ***Formdata errors*** |
      | 400 | BAD REQUEST | ***FORMDATA_IS_EMPTY*** |
      | ***Query params errors*** |
      | 400 | BAD REQUEST | ***INVALID_FILTER_BY*** |
      | 400 | BAD REQUEST | ***INVALID_SELECT*** |
      | 400 | BAD REQUEST | ***INVALID_ID*** |
      | 400 | BAD REQUEST | ***NO_IDENTITY_PROVIDED*** |
      | ***File uploading errors*** |
      | 400 | BAD REQUEST | ***INVALID_JPG*** |
      | 500 | INTERNAL SERVER ERROR | ***CANNOT_SAVE_FILE_ON_SERVER*** |
      | ***Authenticaton API errors*** |
      | 401 | UNAUTHORIZED | ***NO_TOKEN_PROVIDED*** |
      | 401 | UNAUTHORIZED | ***NO_FRESH_TOKEN_PROVIDED*** |
      | 401 | UNAUTHORIZED | ***TOKEN_HAS_EXPIRED*** |
      | 422 | UNPROCESSABLE ENTITY | ***INVALID_TOKEN*** |
      | 409 | CONFLICT | ***USERNAME_ALREADY_EXISTS*** |
      | 409 | CONFLICT | ***EMAIL_ALREADY_EXISTS*** |
      | 409 | CONFLICT | ***USERNAME_NOT_FOUND*** |
      | 409 | CONFLICT | ***INCORRECT_PASSWORD*** |
      | 403 | FORBIDDEN | ***USER_IS_BANNED*** |
      | ***User API errors*** |
      | 409 | CONFLICT | ***USERNAME_ALREADY_EXISTS*** |
      | 409 | CONFLICT | ***EMAIL_ALREADY_EXISTS*** |
      | 404 | NOT FOUND | ***USERS_NOT_FOUND*** |
      | 404 | NOT FOUND | ***USER_NOT_FOUND*** |

      -----------------------------------------------
  
  version: 'beta 0.0.1'

  contact:
    url: https://vk.com/akumii
    email: toropkibn@gmail.com

  license:
    name: Nginx 1.18.0
    url: https://nginx.org/LICENSE

externalDocs:
  description: ilow Gitlab!
  url: https://gitlab.eugenv.ru

tags:
  - name: User Authentication API
    description: Do everything with authentication :)
  - name: User API
    description: Do everything with users :)
  - name: Media API
    description: Do everything with media :)
  - name: Rooms API
    description: Do everything with rooms :)

################################################################################
#                            Hosts, Servers, cookies auth                      #
################################################################################

servers: [
  {
    "url": "https://ilow-api.eugenv.ru/",
    "description": "Development server"
  },
  {
    "url": "http://127.0.0.1:8302/",
    "description": "Local server"
  },
  {
    "url": "No production server is present...",
  }
]

################################################################################
#                                    Paths                                     #
################################################################################

paths:
  /auth/signup:
    post:
      summary: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

      tags:
        - User Authentication API

      operationId: signup

      requestBody:
        required: true
        description: –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π JSON
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SipnupSchema'

      responses:
        200:
          description: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–∞–Ω, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –µ–≥–æ —Å—É—â–Ω–æ—Å—Ç—å —Å access-token –∏ refresh-token.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserSchema'

  /auth/login:
    post:
      summary: –õ–æ–≥–∏–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

      tags:
        - User Authentication API

      operationId: login

      requestBody:
        required: true
        description: –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π JSON
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginSchema'

      responses:
        200:
          description: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–ª–æ–≥–∏–Ω–∏–ª—Å—è, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –µ–≥–æ —Å—É—â–Ω–æ—Å—Ç—å —Å access-token –∏ refresh-token.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserSchema'

  /auth/logout:
    post:
      security:
        - cookieAuth: []

      operationId: logout

      summary: –í—ã—Ö–æ–¥ –∏–∑ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, —Å–±—Ä–æ—Å cookies

      tags:
        - User Authentication API

      responses:
        200:
          description: –í—ã–≤–æ–¥–∏—Ç {logout = true}, —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç —Ç–æ–∫–µ–Ω—ã –∏–∑ cookies

  /auth/refresh:
    post:
      security:
        - cookieAuth: []

      operationId: refresh

      summary: –ó–∞–ø—Ä–æ—Å–∏—Ç—å –Ω–æ–≤—ã–π —Ç–æ–∫–µ–Ω, –∫–æ–≥–¥–∞ –∏—Å—Ç–µ—á—ë—Ç —Å—Ä–æ–∫ —Å—Ç–∞—Ä–æ–≥–æ

      description: |
        –ö–æ–≥–¥–∞ access-token –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –∏—Å—Ç–µ–∫–∞–µ—Ç, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è refresh-token –¥–ª—è –µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

      tags:
        - User Authentication API

      responses:
        200:
          description: –í—ã–≤–æ–¥–∏—Ç {refresh = true}, —Å—Ç–∞–≤–∏—Ç –Ω–æ–≤—ã–π —Ç–æ–∫–µ–Ω –≤ cookies

  /user/all:
    get:

      operationId: get_users

      summary: –ü–æ–ª—É—á–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

      description: –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫.

      tags:
        - User API

      parameters:
      - in: query
        name: select
        required: false
        description: |
          –ü–æ–ª—É—á–∏—Ç—å —Ç–æ–ª—å–∫–æ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–µ –ø–æ–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –ø–µ—Ä–µ—á–∏—Å–ª—è—é—Ç—Å—è —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é (id,username). 
          üìù **Note:** –ù–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫–∏!!!
        type: string
      - in: query
        name: ids
        required: false
        description: –ü–æ–ª—É—á–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ id, –ø–µ—Ä–µ—á–∏—Å–ª—è—é—Ç—Å—è —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é (1,2,4). 
        type: string
      - in: query
        name: filter_by
        required: false
        description: |
          –û—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ –∑–Ω–∞—á–µ–Ω–∏—è–º –ø–æ–ª–µ–π, –Ω–∞–ø—Ä–∏–º–µ—Ä `filter_by=displayName=Sasha,isBanned=false,avatar=null`.
        type: string

      responses:
        200:
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserSchema'

  /user:
    patch:
      security:
        - cookieAuth: []

      operationId: update_user

      summary: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ–±–Ω–æ–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –∞–∫–∫–∞—É–Ω—Ç–∞.

      tags:
        - User API

      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              $ref: '#/components/schemas/UserUpdateSchema'

      responses:
        200:
          description: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –µ–≥–æ —Å—É—â–Ω–æ—Å—Ç—å.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserSchema'

    get:
      operationId: get_user

      summary: –ü–æ–ª—É—á–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

      tags:
        - User API

      parameters:
      - in: query
        name: select
        required: false
        description: |
          –ü–æ–ª—É—á–∏—Ç—å —Ç–æ–ª—å–∫–æ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–µ –ø–æ–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –ø–µ—Ä–µ—á–∏—Å–ª—è—é—Ç—Å—è —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é (id,username).
          üìù **Note:** –ù–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫–∏!!
        type: string
      - in: query
        name: id
        required: false
        description: –ü–æ–ª—É—á–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ id, –ø—Ä–∏–Ω–∏–º–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ id=—á–∏—Å–ª–æ, –∏–Ω–∞—á–µ –≤—ã–≤–µ–¥–µ—Ç –æ—à–∏–±–∫—É.
        type: int
      - in: query
        name: username
        required: false
        description: –ü–æ–ª—É—á–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ username
        type: string

      responses:
        200:
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserSchema'

    delete:
      security:
        - cookieAuth: []

      operationId: delete_user

      summary: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–¥–∞–ª—è–µ—Ç –∞–∫–∫–∞—É–Ω—Ç.

      tags:
        - User API

      parameters:
      - in: query
        name: id
        required: false
        description: –£–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ id, –ø—Ä–∏–Ω–∏–º–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ id=—á–∏—Å–ª–æ, –∏–Ω–∞—á–µ –≤—ã–≤–µ–¥–µ—Ç –æ—à–∏–±–∫—É.
        type: int

      responses:
        200:
          description: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–¥–∞–ª—è–µ—Ç—Å—è, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –µ–≥–æ —Å—É—â–Ω–æ—Å—Ç—å.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserSchema'


################################################################################
#                                    Schemas                                   #
################################################################################


components:
  schemas:
    SipnupSchema:
      type: object
      properties:
        username:
          type: string
          nullable: false
          maxLength: 30
          minLength: 5
          description: |
            –£–Ω–∏–∫–∞–ª—å–Ω—ã–π username –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –∏–º–µ–µ—Ç `regexp = ^[a-zA-Z0-9._-]+$`
          required: true
          example: "nick2004"
        password:
          type: string
          nullable: false
          minLength: 8
          description: |
            –∏–º–µ–µ—Ç `regexp = ^[a-zA-Z0-9.@_-]+$`
          required: true
          example: 'somepassword'
        email:
          type: string
          nullable: false
          minLength: 1
          required: true
          example: 'example@example.org'
        displayName:
          type: string
          nullable: false
          maxLength: 30
          minLength: 1
          description: –ù–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —É–Ω–∏–∫–∞–ª—å–Ω–æ–µ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –∫–æ—Ç–æ—Ä–æ–µ –±—É–¥–µ—Ç –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å—Å—è –¥—Ä—É–≥–∏–º
          required: true
          example: 'Lolkek'

    LoginSchema:
      type: object
      properties:
        username:
          type: string
          nullable: false
          maxLength: 30
          minLength: 5
          description: |
            –£–Ω–∏–∫–∞–ª—å–Ω—ã–π username –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –∏–º–µ–µ—Ç `regexp = ^[a-zA-Z0-9._-]+$`
          required: true
          example: "nick2004"

        password:
          type: string
          nullable: false
          minLength: 8
          description: |
            –∏–º–µ–µ—Ç `regexp = ^[a-zA-Z0-9.@_-]+$`
          required: true
          example: 'somepassword'

    UserUpdateSchema:
      type: object
      properties:
        username:
          type: string
          nullable: false
          maxLength: 30
          minLength: 5
          description: |
            –£–Ω–∏–∫–∞–ª—å–Ω—ã–π username –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –∏–º–µ–µ—Ç `regexp = ^[a-zA-Z0-9._-]+$`
          required: false
          example: "nick2004"
        displayName:
          type: string
          minLength: 1
          maxLength: 30
          required: false
          example: 'Lolkek'
        email:
          type: string
          required: false
          minLength: 1
          example: 'example@example.org'
        birthday:
          type: int
          required: false
          min: 86400
          description: 'timestamp'
          example: 1710230677
        description:
          type: string
          required: false
          minLength: 1
          maxLength: 140
          example: '–û–ø–∏—Å–∞–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—á–∫–∏–∏'
        avatar:
          required: false
          type: string
          format: binary
          description: —Ç–æ–ª—å–∫–æ .jpg

    UserSchema:
      type: object
      properties:
        id:
          type: integer
          nullable: false
          example: 1
        username:
          type: string
          nullable: false
          example: 'nick2004'
        displayName:
          type: string
          nullable: false
          example: 'Lolkek'
        email:
          type: string
          nullable: false
          example: 'example@example.org'
        isBanned:
          type: boolean
          nullable: false
          example: false
        registrationDate:
          type: int
          nullable: false
          description: 'timestamp'
          example: 1710230677
        birthday:
          type: int
          nullable: true
          description: 'timestamp'
          example: 1710230677
        description:
          type: string
          nullable: true
          example: '–û–ø–∏—Å–∞–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—á–∫–∏–∏'
        avatar:
          type: string
          nullable: true
          example: 'ilow-api.eugenv.ru/static/images/avatar_id_1.png'